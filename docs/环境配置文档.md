# ç¯å¢ƒé…ç½®æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† Claude GPT é¡¹ç›®çš„ç¯å¢ƒé…ç½®ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–¹æ¡ˆï¼Œä»¥åŠå¯†é’¥ç®¡ç†ç­–ç•¥ã€‚

## é¡¹ç›®ç»“æ„

```
claude-gpt/
â”œâ”€â”€ frontend/                 # React Native å‰ç«¯
â”‚   â”œâ”€â”€ .env.development     # å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ .env.staging         # å‰ç«¯æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ .env.production      # å‰ç«¯ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ app.config.js        # Expo é…ç½®æ–‡ä»¶
â”œâ”€â”€ backend/                 # Node.js åç«¯
â”‚   â”œâ”€â”€ .env.development     # åç«¯å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ .env.staging         # åç«¯æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ .env.production      # åç«¯ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ config/              # é…ç½®æ–‡ä»¶å¤¹
â”‚       â”œâ”€â”€ database.ts      # æ•°æ®åº“é…ç½®
â”‚       â”œâ”€â”€ redis.ts         # Redis é…ç½®
â”‚       â””â”€â”€ app.ts           # åº”ç”¨é…ç½®
â””â”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
```

## å‰ç«¯ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ (.env.development)
```bash
# APIé…ç½®
API_BASE_URL=http://localhost:3000/api/v1
WS_BASE_URL=ws://localhost:3000

# åº”ç”¨é…ç½®
APP_ENV=development
APP_NAME=Claude GPT Dev
APP_VERSION=1.0.0

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug
ENABLE_LOGGING=true

# è°ƒè¯•é…ç½®
ENABLE_FLIPPER=true
ENABLE_REACTOTRON=true

# Stripeé…ç½® (æµ‹è¯•å¯†é’¥)
STRIPE_PUBLISHABLE_KEY=pk_test_51234567890abcdef

# Sentryé…ç½® (å¯é€‰)
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENABLED=false

# åŠŸèƒ½å¼€å…³
ENABLE_ANALYTICS=false
ENABLE_CRASH_REPORTING=false
```

### æµ‹è¯•ç¯å¢ƒ (.env.staging)
```bash
# APIé…ç½®
API_BASE_URL=https://api-staging.claudegpt.com/api/v1
WS_BASE_URL=wss://api-staging.claudegpt.com

# åº”ç”¨é…ç½®
APP_ENV=staging
APP_NAME=Claude GPT Staging
APP_VERSION=1.0.0

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
ENABLE_LOGGING=true

# è°ƒè¯•é…ç½®
ENABLE_FLIPPER=false
ENABLE_REACTOTRON=false

# Stripeé…ç½® (æµ‹è¯•å¯†é’¥)
STRIPE_PUBLISHABLE_KEY=pk_test_51234567890abcdef

# Sentryé…ç½®
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENABLED=true

# åŠŸèƒ½å¼€å…³
ENABLE_ANALYTICS=true
ENABLE_CRASH_REPORTING=true
```

### ç”Ÿäº§ç¯å¢ƒ (.env.production)
```bash
# APIé…ç½®
API_BASE_URL=https://api.claudegpt.com/api/v1
WS_BASE_URL=wss://api.claudegpt.com

# åº”ç”¨é…ç½®
APP_ENV=production
APP_NAME=Claude GPT
APP_VERSION=1.0.0

# æ—¥å¿—é…ç½®
LOG_LEVEL=error
ENABLE_LOGGING=false

# è°ƒè¯•é…ç½®
ENABLE_FLIPPER=false
ENABLE_REACTOTRON=false

# Stripeé…ç½® (ç”Ÿäº§å¯†é’¥)
STRIPE_PUBLISHABLE_KEY=pk_live_51234567890abcdef

# Sentryé…ç½®
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENABLED=true

# åŠŸèƒ½å¼€å…³
ENABLE_ANALYTICS=true
ENABLE_CRASH_REPORTING=true
```

## åç«¯ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ (.env.development)
```bash
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
APP_NAME=Claude GPT API
APP_VERSION=1.0.0

# æ•°æ®åº“é…ç½® (æœ¬åœ°PostgreSQL)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=claude_gpt_dev
DB_USERNAME=postgres
DB_PASSWORD=postgres123
DB_SSL=false
DB_POOL_MIN=2
DB_POOL_MAX=10

# Redisé…ç½® (å¯é€‰ï¼Œç”¨äºç¼“å­˜)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-for-development-only
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=30d

# OpenAIé…ç½® (æ¨¡æ‹Ÿå¯†é’¥)
OPENAI_API_KEY=sk-1234567890abcdefghijklmnopqrstuvwxyz123456789012345678
OPENAI_ORG_ID=org-1234567890abcdef
OPENAI_BASE_URL=https://api.openai.com/v1

# Stripeé…ç½® (æµ‹è¯•å¯†é’¥)
STRIPE_SECRET_KEY=sk_test_51234567890abcdefghijklmnopqrstuvwxyz
STRIPE_WEBHOOK_SECRET=whsec_1234567890abcdefghijklmnopqrstuvw
STRIPE_WEBHOOK_ENDPOINT=/api/v1/webhooks/stripe

# é‚®ä»¶é…ç½® (å¼€å‘ç¯å¢ƒä½¿ç”¨MailHog)
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=noreply@claudegpt.local

# æ–‡ä»¶å­˜å‚¨é…ç½®
UPLOAD_DIR=uploads
MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,application/pdf

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug
LOG_FILE=logs/app.log
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5

# å®‰å…¨é…ç½®
BCRYPT_ROUNDS=12
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
CORS_ORIGIN=http://localhost:19006,exp://localhost:19000

# ç›‘æ§é…ç½®
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENABLED=false
HEALTH_CHECK_ENDPOINT=/health
```

### æµ‹è¯•ç¯å¢ƒ (.env.staging)
```bash
# åº”ç”¨é…ç½®
NODE_ENV=staging
PORT=3000
APP_NAME=Claude GPT API Staging
APP_VERSION=1.0.0

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=claude_gpt_staging
DB_USERNAME=postgres
DB_PASSWORD=SecurePassword123!
DB_SSL=true
DB_POOL_MIN=5
DB_POOL_MAX=20

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=SecureRedisPassword123!
REDIS_DB=1

# JWTé…ç½®
JWT_SECRET=your-staging-jwt-secret-key-should-be-very-long-and-secure
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=30d

# OpenAIé…ç½® (æµ‹è¯•å¯†é’¥)
OPENAI_API_KEY=sk-test1234567890abcdefghijklmnopqrstuvwxyz123456789012345
OPENAI_ORG_ID=org-test1234567890abcdef
OPENAI_BASE_URL=https://api.openai.com/v1

# Stripeé…ç½® (æµ‹è¯•å¯†é’¥)
STRIPE_SECRET_KEY=sk_test_staging1234567890abcdefghijklmnopqrstuvwxyz
STRIPE_WEBHOOK_SECRET=whsec_staging1234567890abcdefghijklmnopqrstuvw
STRIPE_WEBHOOK_ENDPOINT=/api/v1/webhooks/stripe

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_USER=noreply@staging.claudegpt.com
SMTP_PASSWORD=mailgun-api-key
SMTP_FROM=Claude GPT Staging <noreply@staging.claudegpt.com>

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FILE=logs/app.log
LOG_MAX_SIZE=50m
LOG_MAX_FILES=10

# å®‰å…¨é…ç½®
BCRYPT_ROUNDS=12
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=200
CORS_ORIGIN=https://staging.claudegpt.com

# ç›‘æ§é…ç½®
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENABLED=true
```

### ç”Ÿäº§ç¯å¢ƒ (.env.production)
```bash
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000
APP_NAME=Claude GPT API
APP_VERSION=1.0.0

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=claude_gpt_prod
DB_USERNAME=postgres
DB_PASSWORD=${DB_PASSWORD_FROM_SECRETS}
DB_SSL=true
DB_POOL_MIN=10
DB_POOL_MAX=50

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=${REDIS_PASSWORD_FROM_SECRETS}
REDIS_DB=0

# JWTé…ç½®
JWT_SECRET=${JWT_SECRET_FROM_SECRETS}
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=30d

# OpenAIé…ç½® (ç”Ÿäº§å¯†é’¥)
OPENAI_API_KEY=${OPENAI_API_KEY_FROM_SECRETS}
OPENAI_ORG_ID=${OPENAI_ORG_ID_FROM_SECRETS}
OPENAI_BASE_URL=https://api.openai.com/v1

# Stripeé…ç½® (ç”Ÿäº§å¯†é’¥)
STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY_FROM_SECRETS}
STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET_FROM_SECRETS}
STRIPE_WEBHOOK_ENDPOINT=/api/v1/webhooks/stripe

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_USER=noreply@claudegpt.com
SMTP_PASSWORD=${SMTP_PASSWORD_FROM_SECRETS}
SMTP_FROM=Claude GPT <noreply@claudegpt.com>

# æ—¥å¿—é…ç½®
LOG_LEVEL=warn
LOG_FILE=logs/app.log
LOG_MAX_SIZE=100m
LOG_MAX_FILES=30

# å®‰å…¨é…ç½®
BCRYPT_ROUNDS=14
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=500
CORS_ORIGIN=https://claudegpt.com

# ç›‘æ§é…ç½®
SENTRY_DSN=${SENTRY_DSN_FROM_SECRETS}
SENTRY_ENABLED=true
```

## å¯†é’¥ç®¡ç†ç­–ç•¥

### 1. å¼€å‘ç¯å¢ƒå¯†é’¥
å¼€å‘ç¯å¢ƒä½¿ç”¨æ¨¡æ‹Ÿå¯†é’¥ï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•ï¼š

```typescript
// config/keys.development.ts
export const developmentKeys = {
  openai: {
    apiKey: 'sk-dev1234567890abcdefghijklmnopqrstuvwxyz123456789012345678',
    orgId: 'org-dev1234567890abcdef'
  },
  stripe: {
    secretKey: 'sk_test_dev1234567890abcdefghijklmnopqrstuvwxyz',
    publishableKey: 'pk_test_dev1234567890abcdef',
    webhookSecret: 'whsec_dev1234567890abcdefghijklmnopqrstuvw'
  },
  jwt: {
    secret: 'development-jwt-secret-key-not-for-production',
    expiresIn: '1h'
  },
  database: {
    url: 'postgresql://postgres:postgres123@localhost:5432/claude_gpt_dev'
  }
};
```

### 2. å¯†é’¥é…ç½®æ–‡ä»¶æ¨¡æ¿
```typescript
// config/keys.template.ts
export interface KeysConfig {
  openai: {
    apiKey: string;
    orgId: string;
  };
  stripe: {
    secretKey: string;
    publishableKey: string;
    webhookSecret: string;
  };
  jwt: {
    secret: string;
    expiresIn: string;
  };
  database: {
    host: string;
    port: number;
    name: string;
    username: string;
    password: string;
  };
}
```

### 3. å¯†é’¥åŠ è½½é€»è¾‘
```typescript
// config/keys.ts
import { developmentKeys } from './keys.development';

export function loadKeys(): KeysConfig {
  const env = process.env.NODE_ENV || 'development';
  
  switch (env) {
    case 'development':
      return developmentKeys;
    
    case 'staging':
    case 'production':
      return {
        openai: {
          apiKey: process.env.OPENAI_API_KEY!,
          orgId: process.env.OPENAI_ORG_ID!
        },
        stripe: {
          secretKey: process.env.STRIPE_SECRET_KEY!,
          publishableKey: process.env.STRIPE_PUBLISHABLE_KEY!,
          webhookSecret: process.env.STRIPE_WEBHOOK_SECRET!
        },
        jwt: {
          secret: process.env.JWT_SECRET!,
          expiresIn: process.env.JWT_EXPIRES_IN || '1h'
        },
        database: {
          host: process.env.DB_HOST!,
          port: parseInt(process.env.DB_PORT!),
          name: process.env.DB_NAME!,
          username: process.env.DB_USERNAME!,
          password: process.env.DB_PASSWORD!
        }
      };
    
    default:
      throw new Error(`Unknown environment: ${env}`);
  }
}

// éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
export function validateKeys(keys: KeysConfig): void {
  const requiredKeys = [
    'openai.apiKey',
    'stripe.secretKey',
    'jwt.secret',
    'database.host'
  ];
  
  for (const keyPath of requiredKeys) {
    const value = keyPath.split('.').reduce((obj, key) => obj?.[key], keys);
    if (!value) {
      throw new Error(`Missing required configuration: ${keyPath}`);
    }
  }
}
```

## æ•°æ®åº“é…ç½®

### æœ¬åœ°PostgreSQLå®‰è£…å’Œé…ç½®

#### 1. å®‰è£…PostgreSQL
```bash
# macOS (ä½¿ç”¨Homebrew)
brew install postgresql
brew services start postgresql

# Ubuntu/Debian
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql

# Windows
# ä¸‹è½½å¹¶å®‰è£…PostgreSQLå®˜æ–¹å®‰è£…åŒ…
```

#### 2. åˆ›å»ºæ•°æ®åº“ç”¨æˆ·å’Œæ•°æ®åº“
```sql
-- åˆ›å»ºç”¨æˆ·
CREATE USER claude_gpt_user WITH PASSWORD 'secure_password_123';

-- åˆ›å»ºå¼€å‘æ•°æ®åº“
CREATE DATABASE claude_gpt_dev OWNER claude_gpt_user;

-- åˆ›å»ºæµ‹è¯•æ•°æ®åº“
CREATE DATABASE claude_gpt_test OWNER claude_gpt_user;

-- æˆæƒ
GRANT ALL PRIVILEGES ON DATABASE claude_gpt_dev TO claude_gpt_user;
GRANT ALL PRIVILEGES ON DATABASE claude_gpt_test TO claude_gpt_user;
```

#### 3. æ•°æ®åº“è¿æ¥é…ç½®
```typescript
// config/database.ts
import { DataSource } from 'typeorm';
import { loadKeys } from './keys';

const keys = loadKeys();

export const AppDataSource = new DataSource({
  type: 'postgres',
  host: keys.database.host,
  port: keys.database.port,
  username: keys.database.username,
  password: keys.database.password,
  database: keys.database.name,
  synchronize: process.env.NODE_ENV === 'development',
  logging: process.env.NODE_ENV === 'development',
  entities: ['src/entities/*.ts'],
  migrations: ['src/migrations/*.ts'],
  subscribers: ['src/subscribers/*.ts'],
});
```

## Dockeré…ç½® (å¯é€‰)

### 1. å¼€å‘ç¯å¢ƒDocker Compose
```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: claude_gpt_dev
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres123
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./scripts/init-db.sql:/docker-entrypoint-initdb.d/init-db.sql

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --requirepass redis123

  mailhog:
    image: mailhog/mailhog
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI

volumes:
  postgres_data:
```

### 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.dev.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# åœæ­¢æœåŠ¡
docker-compose -f docker-compose.dev.yml down
```

## é…ç½®éªŒè¯è„šæœ¬

### 1. ç¯å¢ƒé…ç½®æ£€æŸ¥
```typescript
// scripts/check-config.ts
import { loadKeys, validateKeys } from '../config/keys';

async function checkConfiguration() {
  try {
    console.log('ğŸ” æ£€æŸ¥ç¯å¢ƒé…ç½®...');
    
    const keys = loadKeys();
    validateKeys(keys);
    
    console.log('âœ… ç¯å¢ƒé…ç½®éªŒè¯é€šè¿‡');
    
    // æ£€æŸ¥æ•°æ®åº“è¿æ¥
    await checkDatabase();
    
    // æ£€æŸ¥å¤–éƒ¨æœåŠ¡
    await checkExternalServices();
    
    console.log('ğŸ‰ æ‰€æœ‰é…ç½®æ£€æŸ¥å®Œæˆ');
  } catch (error) {
    console.error('âŒ é…ç½®æ£€æŸ¥å¤±è´¥:', error.message);
    process.exit(1);
  }
}

async function checkDatabase() {
  console.log('ğŸ” æ£€æŸ¥æ•°æ®åº“è¿æ¥...');
  // æ•°æ®åº“è¿æ¥æ£€æŸ¥é€»è¾‘
  console.log('âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸');
}

async function checkExternalServices() {
  console.log('ğŸ” æ£€æŸ¥å¤–éƒ¨æœåŠ¡...');
  // OpenAI APIæ£€æŸ¥
  // Stripe APIæ£€æŸ¥
  console.log('âœ… å¤–éƒ¨æœåŠ¡è¿æ¥æ­£å¸¸');
}

checkConfiguration();
```

### 2. è¿è¡Œé…ç½®æ£€æŸ¥
```bash
# å¼€å‘ç¯å¢ƒ
npm run check:config:dev

# æµ‹è¯•ç¯å¢ƒ
npm run check:config:staging

# ç”Ÿäº§ç¯å¢ƒ
npm run check:config:prod
```

## éƒ¨ç½²é…ç½®

### 1. ç¯å¢ƒå˜é‡æ³¨å…¥
```bash
# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è„šæœ¬
#!/bin/bash

# ä»å¯†é’¥ç®¡ç†æœåŠ¡è·å–å¯†é’¥
export OPENAI_API_KEY=$(get-secret "openai-api-key")
export STRIPE_SECRET_KEY=$(get-secret "stripe-secret-key")
export JWT_SECRET=$(get-secret "jwt-secret")
export DB_PASSWORD=$(get-secret "db-password")

# å¯åŠ¨åº”ç”¨
npm start
```

### 2. Kubernetes ConfigMap (ç”Ÿäº§ç¯å¢ƒ)
```yaml
# k8s/configmap.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: claude-gpt-config
data:
  NODE_ENV: "production"
  PORT: "3000"
  DB_HOST: "localhost"
  DB_PORT: "5432"
  DB_NAME: "claude_gpt_prod"
  LOG_LEVEL: "warn"
---
apiVersion: v1
kind: Secret
metadata:
  name: claude-gpt-secrets
type: Opaque
stringData:
  openai-api-key: "${OPENAI_API_KEY}"
  stripe-secret-key: "${STRIPE_SECRET_KEY}"
  jwt-secret: "${JWT_SECRET}"
  db-password: "${DB_PASSWORD}"
```

è¿™ä¸ªç¯å¢ƒé…ç½®æ–‡æ¡£æä¾›äº†å®Œæ•´çš„å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒé…ç½®æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¯†é’¥ç®¡ç†ã€æ•°æ®åº“é…ç½®å’Œéƒ¨ç½²ç­–ç•¥ï¼Œç¡®ä¿é¡¹ç›®åœ¨ä¸åŒç¯å¢ƒä¸‹çš„æ­£ç¡®è¿è¡Œã€‚